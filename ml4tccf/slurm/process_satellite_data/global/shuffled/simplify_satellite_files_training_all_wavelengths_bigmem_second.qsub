#!/bin/tcsh

#SBATCH --job-name="simplify_satellite_files_training_all_wavelengths_bigmem"
#SBATCH --partition="bigmem"
#SBATCH --account="gsd-hpcs"
#SBATCH --qos="batch"
#SBATCH --ntasks=1
#SBATCH --nodes=1
#SBATCH --cpus-per-task=1
##SBATCH --nodes=1
##SBATCH --ntasks=1
##SBATCH --cpus-per-task=1
##SBATCH --ntasks-per-node=1
#SBATCH --time=24:00:00
#SBATCH --array=100-197
#SBATCH --exclude=h28n12
##SBATCH --exclude=h31n03,h28n12
##SBATCH --exclude=h29n01,h26n05,h28n06,h29n07,h30n03,h30n15
#SBATCH --mail-type=BEGIN,END,FAIL
#SBATCH --mail-user=ryan.lagerquist@noaa.gov
#SBATCH --output=simplify_satellite_files_training_all_wavelengths_bigmem_%A_%a.out

module load cuda/10.1
source /scratch2/BMC/gsd-hpcs/Jebb.Q.Stewart/conda3.7/etc/profile.d/conda.csh
conda activate base

set CODE_DIR_NAME="/scratch1/RDARCH/rda-ghpcs/Ryan.Lagerquist/ml4tccf_standalone/ml4tccf"
set INPUT_DIR_NAME="/scratch1/RDARCH/rda-ghpcs/Ryan.Lagerquist/ml4tccf_project/satellite_data/processed/normalized_params_from_2017-2020/shuffled_6hour_chunks/training_2017-2021"
set OUTPUT_DIR_NAME="${INPUT_DIR_NAME}/simplified_all_wavelengths"

set FILE_NUMBER_SET_STRINGS=("0 1 2" "3 4 5" "6 7 8" "9 10 11" "12 13 14" "15 16 17" "18 19 20" "21 22 23" "24 25 26" "27 28 29" "30 31 32" "33 34 35" "36 37 38" "39 40 41" "42 43 44" "45 46 47" "48 49 50" "51 52 53" "54 55 56" "57 58 59" "60 61 62" "63 64 65" "66 67 68" "69 70 71" "72 73 74" "75 76 77" "78 79 80" "81 82 83" "84 85 86" "87 88 89" "90 91 92" "93 94 95" "96 97 98" "99 100 101" "102 103 104" "105 106 107" "108 109 110" "111 112 113" "114 115 116" "117 118 119" "120 121 122" "123 124 125" "126 127 128" "129 130 131" "132 133 134" "135 136 137" "138 139 140" "141 142 143" "144 145 146" "147 148 149" "150 151 152" "153 154 155" "156 157 158" "159 160 161" "162 163 164" "165 166 167" "168 169 170" "171 172 173" "174 175 176" "177 178 179" "180 181 182" "183 184 185" "186 187 188" "189 190 191" "192 193 194" "195 196 197" "198 199 200" "201 202 203" "204 205 206" "207 208 209" "210 211 212" "213 214 215" "216 217 218" "219 220 221" "222 223 224" "225 226 227" "228 229 230" "231 232 233" "234 235 236" "237 238 239" "240 241 242" "243 244 245" "246 247 248" "249 250 251" "252 253 254" "255 256 257" "258 259 260" "261 262 263" "264 265 266" "267 268 269" "270 271 272" "273 274 275" "276 277 278" "279 280 281" "282 283 284" "285 286 287" "288 289 290" "291 292 293" "294 295 296" "297 298 10000" "10001 10002 10003" "10004 10005 10006" "10007 10008 10009" "10010 10011 10012" "10013 10014 10015" "10016 10017 10018" "10019 10020 10021" "10022 10023 10024" "10025 10026 10027" "10028 10029 10030" "10031 10032 10033" "10034 10035 10036" "10037 10038 10039" "10040 10041 10042" "10043 10044 10045" "10046 10047 10048" "10049 10050 10051" "10052 10053 10054" "10055 10056 10057" "10058 10059 10060" "10061 10062 10063" "10064 10065 10066" "10067 10068 10069" "10070 10071 10072" "10073 10074 10075" "10076 10077 10078" "10079 10080 10081" "10082 10083 10084" "10085 10086 10087" "10088 10089 10090" "10091 10092 10093" "10094 10095 10096" "10097 10098 10099" "10100 10101 10102" "10103 10104 10105" "10106 10107 10108" "10109 10110 10111" "10112 10113 10114" "10115 10116 10117" "10118 10119 10120" "10121 10122 10123" "10124 10125 10126" "10127 10128 10129" "10130 10131 10132" "10133 10134 10135" "10136 10137 10138" "10139 10140 10141" "10142 10143 10144" "10145 10146 10147" "10148 10149 10150" "10151 10152 10153" "10154 10155 10156" "10157 10158 10159" "10160 10161 10162" "10163 10164 10165" "10166 10167 10168" "10169 10170 10171" "10172 10173 10174" "10175 10176 10177" "10178 10179 10180" "10181 10182 10183" "10184 10185 10186" "10187 10188 10189" "10190 10191 10192" "10193 10194 10195" "10196 10197 10198" "10199 10200 10201" "10202 10203 10204" "10205 10206 10207" "10208 10209 10210" "10211 10212 10213" "10214 10215 10216" "10217 10218 10219" "10220 10221 10222" "10223 10224 10225" "10226 10227 10228" "10229 10230 10231" "10232 10233 10234" "10235 10236 10237" "10238 10239 10240" "10241 10242 10243" "10244 10245 10246" "10247 10248 10249" "10250 10251 10252" "10253 10254 10255" "10256 10257 10258" "10259 10260 10261" "10262 10263 10264" "10265 10266 10267" "10268 10269 10270" "10271 10272 10273" "10274 10275 10276" "10277 10278 10279" "10280 10281 10282" "10283 10284 10285" "10286 10287 10288" "10289 10290")

set file_number_set_string="${FILE_NUMBER_SET_STRINGS[$SLURM_ARRAY_TASK_ID]}"
set file_numbers=($file_number_set_string:as/ / /g)

foreach file_number ($file_numbers)
    python3 -u "${CODE_DIR_NAME}/simplify_satellite_files.py" \
    --input_dir_name="${INPUT_DIR_NAME}" \
    --shuffled_file_number=${file_number} \
    --wavelengths_to_keep_microns 3.9 6.185 6.95 7.34 8.5 9.61 10.35 11.2 12.3 13.3 \
    --output_dir_name="${OUTPUT_DIR_NAME}"
end
