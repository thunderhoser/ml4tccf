#!/bin/bash

#SBATCH --job-name="simplify_training_files"
#SBATCH --partition="fge"
#SBATCH --account="rda-ghpcs"
#SBATCH --qos="gpuwf"
#SBATCH --ntasks=1
#SBATCH --nodes=1
#SBATCH --cpus-per-task=1
##SBATCH --nodes=1
##SBATCH --ntasks=1
##SBATCH --cpus-per-task=1
##SBATCH --ntasks-per-node=1
#SBATCH --time=06:00:00
#SBATCH --array=0-83
#SBATCH --exclude=h28n12
##SBATCH --exclude=h31n03,h28n12
##SBATCH --exclude=h29n01,h26n05,h28n06,h29n07,h30n03,h30n15
#SBATCH --mail-type=BEGIN,END,FAIL
#SBATCH --mail-user=ryan.lagerquist@noaa.gov
#SBATCH --output=simplify_training_files_%A_%a.out

conda init
conda activate base

echo `which conda`
echo `which python3`

CODE_DIR_NAME="/scratch1/RDARCH/rda-ghpcs/Ryan.Lagerquist/ml4tccf_standalone/ml4tccf"
INPUT_DIR_NAME="/scratch1/RDARCH/rda-ghpcs/Ryan.Lagerquist/ml4tccf_project/satellite_data/processed/normalized_for_paper/shuffled_8hour_chunks/training"
OUTPUT_DIR_NAME="${INPUT_DIR_NAME}/900x900_grids"

FILE_NUMBER_SET_STRINGS=("0 1 2 3 4 5 6" "7 8 9 10 11 12 13" "14 15 16 17 18 19 20" "21 22 23 24 25 26 27" "28 29 30 31 32 33 34" "35 36 37 38 39 40 41" "42 43 44 45 46 47 48" "49 50 51 52 53 54 55" "56 57 58 59 60 61 62" "63 64 65 66 67 68 69" "70 71 72 73 74 75 76" "77 78 79 80 81 82 83" "84 10000 10001 10002 10003 10004 10005" "10006 10007 10008 10009 10010 10011 10012" "10013 10014 10015 10016 10017 10018 10019" "10020 10021 10022 10023 10024 10025 10026" "10027 10028 10029 10030 10031 10032 10033" "10034 10035 10036 10037 10038 10039 10040" "10041 10042 10043 10044 10045 10046 10047" "10048 10049 10050 10051 10052 10053 10054" "10055 10056 10057 10058 10059 10060 10061" "10062 10063 10064 10065 10066 10067 10068" "10069 10070 10071 10072 10073 10074 10075" "10076 10077 10078 10079 10080 10081 10082" "10083 20000 20001 20002 20003 20004" "20005 20006 20007 20008 20009 20010 20011" "20012 20013 20014 20015 20016 20017 20018" "20019 20020 20021 20022 20023 20024 20025" "20026 20027 20028 20029 20030 20031 20032" "20033 20034 20035 20036 20037 20038 20039" "20040 20041 20042 20043 20044 20045 20046" "20047 20048 20049 20050 20051 20052 20053" "20054 20055 20056 20057 20058 20059 20060" "20061 20062 20063 20064 20065 20066 20067" "20068 20069 20070 20071 20072 20073 20074" "20075 20076 20077 20078 20079 20080 20081" "20082 20083 20084 30000 30001 30002 30003" "30004 30005 30006 30007 30008 30009 30010" "30011 30012 30013 30014 30015 30016 30017" "30018 30019 30020 30021 30022 30023 30024" "30025 30026 30027 30028 30029 30030 30031" "30032 30033 30034 30035 30036 30037 30038" "30039 30040 30041 30042 30043 30044 30045" "30046 30047 30048 30049 30050 30051 30052" "30053 30054 30055 30056 30057 30058 30059" "30060 30061 30062 30063 30064 30065 30066" "30067 30068 30069 30070 30071 30072 30073" "30074 30075 30076 40000 40001 40002 40003" "40004 40005 40006 40007 40008 40009 40010" "40011 40012 40013 40014 40015 40016 40017" "40018 40019 40020 40021 40022 40023 40024" "40025 40026 40027 40028 40029 40030 40031" "40032 40033 40034 40035 40036 40037 40038" "40039 40040 40041 40042 40043 40044 40045" "40046 40047 40048 40049 40050 40051 40052" "40053 40054 40055 40056 40057 40058 40059" "40060 40061 40062 40063 40064 40065 40066" "40067 40068 40069 40070 40071 40072 40073" "40074 40075 40076 40077 40078 40079 40080" "40081 40082 40083 40084 40085 40086 40087" "40088 40089 40090 40091 40092 50000 50001 50002" "50003 50004 50005 50006 50007 50008 50009" "50010 50011 50012 50013 50014 50015 50016" "50017 50018 50019 50020 50021 50022 50023" "50024 50025 50026 50027 50028 50029 50030" "50031 50032 50033 50034 50035 50036 50037" "50038 50039 50040 50041 50042 50043 50044" "50045 50046 50047 50048 50049 50050 50051" "50052 50053 50054 50055 50056 50057 50058" "50059 50060 50061 50062 50063 50064 50065" "50066 50067 50068 50069 50070 50071 50072" "50073 50074 50075 50076 50077 50078 50079" "60000 60001 60002 60003 60004 60005 60006" "60007 60008 60009 60010 60011 60012 60013" "60014 60015 60016 60017 60018 60019 60020" "60021 60022 60023 60024 60025 60026 60027" "60028 60029 60030 60031 60032 60033 60034" "60035 60036 60037 60038 60039 60040 60041" "60042 60043 60044 60045 60046 60047 60048" "60049 60050 60051 60052 60053 60054 60055" "60056 60057 60058 60059 60060 60061 60062" "60063 60064 60065 60066 60067 60068 60069" "60070 60071 60072 60073 60074 60075 60076" "60077 60078 60079 60080 60081 60082 60083")

file_number_set_string="${FILE_NUMBER_SET_STRINGS[$SLURM_ARRAY_TASK_ID]}"
read -r -a file_numbers <<< "$file_number_set_string"

for file_number in "${file_numbers[@]}"; do
    python3 -u "${CODE_DIR_NAME}/simplify_satellite_files.py" \
    --input_dir_name="${INPUT_DIR_NAME}" \
    --shuffled_file_number=${file_number} \
    --wavelengths_to_keep_microns 3.9 6.185 6.95 7.34 8.5 9.61 10.35 11.2 12.3 13.3 \
    --num_grid_rows_to_keep=900 \
    --num_grid_columns_to_keep=900 \
    --output_dir_name="${OUTPUT_DIR_NAME}"
done
